!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.motherboard=b(function(b){return a[b]})}(this,function(a){"use strict";var b,c,d,e,f,g,h,i=a("EventEmitter");return b=function(){function a(a,b,c){this.target=a,this.type=b,this.handler=c,this.isEnabled=!1}return a.prototype.enable=function(){if(this.isEnabled!==!0)if(this.target instanceof i)this.target.on(this.type,this.handler);else if(this.target instanceof EventTarget)this.target.addEventListener(this.type,this.handler);else if(this.target instanceof NodeList)for(var a=this.target.length;--a>0;)this.target[a].addEventListener(this.type,this.handler)},a.prototype.disable=function(){if(this.target instanceof i)this.target.off(this.type,this.handler);else if(this.target instanceof EventTarget)this.target.removeEventListener(this.type,this.handler);else if(this.target instanceof NodeList)for(var a=this.target.length;--a>0;)this.target[a].removeEventListener(this.type,this.handler);this.isEnabled=!1},a}(),c=function(a){function b(a,b){i.call(this),this.element=a,this.options=Object.assign({},this.constructor.options,b),this.bindings=[]}b.prototype=Object.create(i.prototype);var c=b.prototype;return c.constructor=b,b.options={},c.init=function(){},c.destroy=function(){var a;this.disable();for(a in this)this.hasOwnProperty(a)&&(this[a]=null)},c.getTag=function(){return this.element.dataset.tag},c.findWithTag=function(a){return this.element.querySelector('[data-tag="'+a+'"]')},c.findAllWithTag=function(a){return this.element.querySelectorAll('[data-tag="'+a+'"]')},c.createBinding=function(b,c,d){var e=new a(b,c,d.bind(this));return this.bindings.push(e),e},c.enable=function(){this.bindings.forEach(function(a){a.enable()})},c.disable=function(){this.bindings.forEach(function(a){a.disable()})},b}(b),Array.prototype.find||(Array.prototype.find=function(a){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;d>f;f++)if(b=c[f],a.call(e,b,f,c))return b}),d=void 0,e=function(a){function b(b,c){a.call(this,b,c),this.components=[]}b.prototype=Object.create(a.prototype);var c=b.prototype;return c.constructor=b,c.getComponent=function(a){return this.components.find(function(b){return b.constructor===a})||null},c.getComponents=function(a){return this.components.filter(function(b){return b.constructor===a})},b}(c),f=function(a){function b(b,c){a.call(this,b||document.body,c),this.dispatchers=[]}b.prototype=Object.create(a.prototype);var c=b.prototype;return c.constructor=b,b.prototype.getDispatcher=function(a){return this.dispatchers.find(function(b){return b.constructor===a})||null},b.prototype.getDispatchers=function(a){return this.dispatchers.filter(function(b){return b.constructor===a})},b}(e),g=function(a,b,c){var d={};d._app=null,d._componentLookup={},d._dispatcherLookup={};var e="motherboardComponent",f="motherboardDispatcher",g=function(a,b){var c;for(var c in a)if(a.hasOwnProperty(c)&&a[c]===b)return c};return d.parse=function(a){a=void 0===a?document.body:a;var b,c,e=Array.prototype.slice.call(a.querySelectorAll("[data-dispatcher]")),f=Array.prototype.slice.call(a.querySelectorAll("[data-component]")),g=d._app.dispatchers,h=d._app.components;for(void 0!==a.dataset.dispatcher&&e.unshift(a),void 0!==a.dataset.component&&f.unshift(a),c=e.length,b=0;c>b;b++)d.registerDispatcher(e[b]);for(c=f.length,b=0;c>b;b++)d.registerComponent(f[b]);for(c=g.length,b=0;c>b;b++)g[b].init();for(c=h.length,b=0;c>b;b++)h[b].init()},d.unparse=function(a){var b,c,g,h,i=Array.prototype.slice.call(a.querySelectorAll("[data-dispatcher]")),j=Array.prototype.slice.call(a.querySelectorAll("[data-component]"));void 0!==a.dataset.dispatcher&&i.unshift(a),void 0!==a.dataset.component&&j.unshift(a);for(var k,l=d._app,m=l.element,n=j.length;void 0!==(g=j[--n]);){for(b=g[e],b.disable(),b.destroy(),k=g;(k=k.parentElement)!==m;)c=k[f],void 0!==c&&c.components.splice(c.components.indexOf(b),1);l.components.splice(l.components.indexOf(b),1)}for(n=i.length;void 0!==(h=i[--n]);)c.disable(),c.destroy(),l.dispatchers.splice(l.dispatchers.indexOf(c),1)},d.registerComponent=function(a){var b=a.dataset.component,c=d._componentLookup[b];if(void 0===c)throw new Error('Could not find component named "'+b+'" in component dictionary.');for(var g,h=new c(a,JSON.parse(a.dataset.options||"{}")),i=a,j=d._app.element;(i=i.parentElement)!==j;)g=i[f],void 0!==g&&g.components.push(h);return a[e]=h,d._app.components.push(h),h},d.registerDispatcher=function(a){var b=a.dataset.dispatcher,c=d._dispatcherLookup[b];if(void 0===c)throw new Error('Could not find dispatcher named "'+b+'" in dispatcher dictionary.');var e=new c(a,JSON.parse(a.dataset.options||"{}"));return a[f]=e,d._app.dispatchers.push(e),e},d.create=function(e,f){var h,i=e.prototype;if(i instanceof a)throw new Error("Cannot create App this way. Use `motherboard.mount`.");if(i instanceof b){if(h=g(d._dispatcherLookup,e),void 0===h)throw new Error("Type not found in dictionary of Dispatchers registered with `motherboard.dispatcher(s)`");return f.dataset.dispatcher=h,d.registerDispatcher(f)}if(i instanceof c){if(h=g(d._componentLookup,e),void 0===h)throw new Error("Type not found in dictionary of Components registered with `motherboard.component(s)`");return f.dataset.component=h,d.registerComponent(f)}throw new Error("Could not create component. Type not found.")},d}(f,e,c),h=function(){var a={App:f,Binding:b,Component:c,Dispatcher:e,Parser:g};return a.component=function(b,c){a.Parser._componentLookup[b]=c},a.components=function(b){a.Parser._componentLookup=b},a.dispatchers=function(b){a.Parser._dispatcherLookup=b},a.mount=function(b){a.Parser._app=b,a.Parser.parse(b.element),b.init()},a}()});